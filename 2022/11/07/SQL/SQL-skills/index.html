<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/myfavicon180.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/myfavicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/myfavicon16.ico">
  <link rel="mask-icon" href="/images/myfavicon512.png" color="#222">
  <meta name="google-site-verification" content="w7KbKnFK6ZmNdwvzSukWPppTy0_LnuUA85bPeSxhkOI">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jenifers001d.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":true,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","hits":"找到 ${hits} 個搜索結果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="The following notes are pain points that I encountered when I was doing my job. Listed all of them to remember them and also hope I can help someone who also comes across this issue.">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL skills (MS SQL Server)">
<meta property="og:url" content="https://jenifers001d.github.io/2022/11/07/SQL/SQL-skills/">
<meta property="og:site_name" content="Jenifer.Code.World">
<meta property="og:description" content="The following notes are pain points that I encountered when I was doing my job. Listed all of them to remember them and also hope I can help someone who also comes across this issue.">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/a0hw4NJ.png">
<meta property="article:published_time" content="2022-11-07T05:25:59.235Z">
<meta property="article:modified_time" content="2022-11-07T05:38:39.130Z">
<meta property="article:author" content="Jenifer">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="Intermediate Code">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/a0hw4NJ.png">


<link rel="canonical" href="https://jenifers001d.github.io/2022/11/07/SQL/SQL-skills/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://jenifers001d.github.io/2022/11/07/SQL/SQL-skills/","path":"2022/11/07/SQL/SQL-skills/","title":"SQL skills (MS SQL Server)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SQL skills (MS SQL Server) | Jenifer.Code.World</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Jenifer.Code.World</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Jenifer 的技術筆記</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li><li class="menu-item menu-item-privacy"><a href="/privacy/" rel="section"><i class="fa fa-lock fa-fw"></i>privacy</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Foreword"><span class="nav-number">1.</span> <span class="nav-text">Foreword</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-conditions-in-WHERE-should-not-related-to-LEFT-JOIN"><span class="nav-number">2.</span> <span class="nav-text">The conditions in WHERE should not related to LEFT JOIN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OUTER-APPLY-used-for-derived-table-including-an-outer-query-and-table-valued-functions"><span class="nav-number">3.</span> <span class="nav-text">OUTER APPLY used for derived table including an outer query and table-valued functions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-statement-of-CASE-Statement-after-THEN-should-not-be-conditions"><span class="nav-number">4.</span> <span class="nav-text">The statement of CASE Statement after THEN should not be conditions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CONCAT-and-SUBSTRING"><span class="nav-number">5.</span> <span class="nav-text">CONCAT() and SUBSTRING()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-BY-DISTINCT"><span class="nav-number">6.</span> <span class="nav-text">GROUP BY &#x3D; DISTINCT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-BY-and-Aggregate-Function"><span class="nav-number">7.</span> <span class="nav-text">GROUP BY and Aggregate Function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HAVING-and-GROUP-BY-and-Aggregate-Function"><span class="nav-number">8.</span> <span class="nav-text">HAVING and GROUP BY and Aggregate Function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#N%E2%80%99XXXXXString%E2%80%99"><span class="nav-number">9.</span> <span class="nav-text">N’XXXXXString’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-if-the-object-already-exists-or-not"><span class="nav-number">10.</span> <span class="nav-text">Check if the object already exists or not</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Get-Top-10-Rows-from-a-Table-Randomly"><span class="nav-number">11.</span> <span class="nav-text">Get Top 10 Rows from a Table Randomly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-get-TIME-part"><span class="nav-number">12.</span> <span class="nav-text">How to get TIME part?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-compare-time-in-SQL-Server"><span class="nav-number">13.</span> <span class="nav-text">How to compare time in SQL Server?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EXEC-sp-executesql-sql-EXEC-sql"><span class="nav-number">14.</span> <span class="nav-text">EXEC sp_executesql @sql &#x3D; EXEC (@sql)</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jenifer</p>
  <div class="site-description" itemprop="description">My notes about web development, front-end, back-end and any kind techniques related to IT.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          連結
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9ob3BvdXQuY29tLnR3Lw==" title="https:&#x2F;&#x2F;hopout.com.tw&#x2F;">Explore Taiwan</span>
            </li>
        </ul>
      </div>
    </div><!--google_adsense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6866375976707228" crossorigin="anonymous"></script>
      <div class="sidebar-google-adsense">
        <div class="adsense-title">
          <i class="fab fa-google"></i> AdSense
        </div>
        <div class="google-adsense-instance">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-6866375976707228"
                data-ad-slot="1016873827"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>        
      </div>
<!--/google_adsense-->
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://jenifers001d.github.io/2022/11/07/SQL/SQL-skills/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jenifer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jenifer.Code.World">
      <meta itemprop="description" content="My notes about web development, front-end, back-end and any kind techniques related to IT.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SQL skills (MS SQL Server) | Jenifer.Code.World">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL skills (MS SQL Server)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>
      

      <time title="創建時間：2022-11-07 15:25:59 / 修改時間：15:38:39" itemprop="dateCreated datePublished" datetime="2022-11-07T15:25:59+10:00">2022-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SQL/" itemprop="url" rel="index"><span itemprop="name">SQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><!--google_adsense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6866375976707228" crossorigin="anonymous"></script>
      <div class="postheader-google-adsense">
        <i class="fab fa-google"></i> AdSense
        <div class="google-adsense-instance">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-6866375976707228"
                data-ad-slot="1016873827"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>        
      </div>
<!--/google_adsense--><h2 id="Foreword"><a class="header-anchor" href="#Foreword"></a>Foreword</h2>

<p>The following notes are pain points that I encountered when I was doing my job. Listed all of them to remember them and also hope I can help someone who also comes across this issue.</p>

<h2 id="The-conditions-in-WHERE-should-not-related-to-LEFT-JOIN"><a class="header-anchor" href="#The-conditions-in-WHERE-should-not-related-to-LEFT-JOIN"></a>The conditions in WHERE should not related to LEFT JOIN</h2>
<p>Putting anything related to a LEFT JOIN table into the WHERE clause will automatically turn it into an INNER JOIN. Because if the values of the row of tableB are all <code>NULL</code>, <code>b.age(NULL)</code> cannot compare with <code>30</code>, SQL Server turn a LEFT JOIN into an INNER JOIN.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tableA a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tableB b <span class="keyword">ON</span> b.staffID <span class="operator">=</span> a.staffID</span><br><span class="line"><span class="keyword">WHERE</span> b.age <span class="operator">=</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>
<h2 id="OUTER-APPLY-used-for-derived-table-including-an-outer-query-and-table-valued-functions"><a class="header-anchor" href="#OUTER-APPLY-used-for-derived-table-including-an-outer-query-and-table-valued-functions"></a>OUTER APPLY used for derived table including an outer query and table-valued functions</h2>
<p>OUTER APPLY is used to join a table-valued function or a derived table that refers to the outer query for each row. To add more conditions in the derived table, I use OUTER APPLY instead of LEFT (OUTER) JOIN.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select top n data in tableB and order according to data in tableB</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tableA a</span><br><span class="line"><span class="keyword">OUTER</span> APPLY (<span class="keyword">SELECT</span> TOP <span class="number">2</span> <span class="operator">*</span> </span><br><span class="line">             <span class="keyword">FROM</span> tableB b </span><br><span class="line">             <span class="keyword">WHERE</span> b.staffID <span class="operator">=</span> a.staffID </span><br><span class="line">             <span class="keyword">ORDER</span> <span class="keyword">BY</span> b.timestamp <span class="keyword">DESC</span>) tableB_2</span><br><span class="line"><span class="keyword">WHERE</span> a.year <span class="operator">=</span> <span class="number">2021</span></span><br></pre></td></tr></table></figure>
<h2 id="The-statement-of-CASE-Statement-after-THEN-should-not-be-conditions"><a class="header-anchor" href="#The-statement-of-CASE-Statement-after-THEN-should-not-be-conditions"></a>The statement of CASE Statement after THEN should not be conditions</h2>
<p>The CASE Statement looks like this:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> condition1 <span class="keyword">THEN</span> result1</span><br><span class="line">    <span class="keyword">WHEN</span> condition2 <span class="keyword">THEN</span> result2</span><br><span class="line">    <span class="keyword">WHEN</span> conditionN <span class="keyword">THEN</span> resultN</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<p>The <strong>result</strong> should not be <strong>conditions</strong>.</p>
<p>How can I do if I want to make a comparision under certain conditions?</p>
<div class="danger">
<p>This is <strong>wrong</strong>, but I just use this to express ideas.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- isRight is bit type</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tableA a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tableB b <span class="keyword">ON</span></span><br><span class="line">    (<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> b.isRight <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> b.staffID <span class="operator">=</span> a.staffID</span><br><span class="line">        <span class="keyword">ELSE</span> b.orderID <span class="operator">=</span> a.orderID</span><br><span class="line">    <span class="keyword">END</span>)</span><br></pre></td></tr></table></figure>
</div>
<ol>
<li>CASE = CASE</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tableA a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tableB b <span class="keyword">ON</span></span><br><span class="line">    (<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> b.isRight <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> b.staffID</span><br><span class="line">        <span class="keyword">ELSE</span> b.orderID</span><br><span class="line">    <span class="keyword">END</span>) <span class="operator">=</span></span><br><span class="line">    (<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> b.isRight <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> a.staffID</span><br><span class="line">        <span class="keyword">ELSE</span> a.orderID</span><br><span class="line">    <span class="keyword">END</span>)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>(CASE WHEN TRUE THEN 1 ) = 1</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tableA a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tableB b <span class="keyword">ON</span></span><br><span class="line">    (<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> b.isRight <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b.staffID <span class="operator">=</span> a.staffID <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> b.isRight <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> b.orderID <span class="operator">=</span> a.orderID <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">-1</span>        <span class="comment">-- b.isRight = 1 AND b.staffID != a.staffID</span></span><br><span class="line">                       <span class="comment">-- b.isRight = 0 AND b.orderID != a.orderID</span></span><br><span class="line">    <span class="keyword">END</span>) <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="CONCAT-and-SUBSTRING"><a class="header-anchor" href="#CONCAT-and-SUBSTRING"></a>CONCAT() and SUBSTRING()</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(staffFirstName, <span class="string">&#x27; - &#x27;</span>,  staffSurname) <span class="keyword">FROM</span> tableA</span><br><span class="line"><span class="keyword">WHERE</span> staffSurname <span class="operator">=</span> <span class="string">&#x27;Golden&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hi, I am Jenifer&#x27;</span>, <span class="number">2</span>, <span class="number">12</span>)</span><br><span class="line"><span class="comment">-- Output: i, I am Jeni</span></span><br></pre></td></tr></table></figure>
<h2 id="GROUP-BY-DISTINCT"><a class="header-anchor" href="#GROUP-BY-DISTINCT"></a>GROUP BY = DISTINCT</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> zipcode <span class="keyword">FROM</span> tableStores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> zipcode</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> zipcode <span class="keyword">FROM</span> tableStores</span><br></pre></td></tr></table></figure>
<p>However, if I’d like to use aggregate function, I can’t use DISTINCT.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> zipcode, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> count</span><br><span class="line"><span class="keyword">FROM</span> tableStores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> zipcode</span><br></pre></td></tr></table></figure>
<h2 id="GROUP-BY-and-Aggregate-Function"><a class="header-anchor" href="#GROUP-BY-and-Aggregate-Function"></a>GROUP BY and Aggregate Function</h2>
<table>
<thead>
<tr>
<th style="text-align:center">storeID</th>
<th style="text-align:center">branchName</th>
<th style="text-align:center">revenue</th>
<th style="text-align:center">year</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">AAA</td>
<td style="text-align:center">1000</td>
<td style="text-align:center">2020</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">BBB</td>
<td style="text-align:center">50</td>
<td style="text-align:center">2020</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center">BBB</td>
<td style="text-align:center">25</td>
<td style="text-align:center">2021</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> branchName, <span class="built_in">SUM</span>(revenue)</span><br><span class="line"><span class="keyword">FROM</span> tableStores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> branchName</span><br></pre></td></tr></table></figure>
<p>The result:</p>
<table>
<thead>
<tr>
<th style="text-align:center">branchName</th>
<th style="text-align:center">revenue</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AAA</td>
<td style="text-align:center">1000</td>
</tr>
<tr>
<td style="text-align:center">BBB</td>
<td style="text-align:center">75</td>
</tr>
</tbody>
</table>
<h2 id="HAVING-and-GROUP-BY-and-Aggregate-Function"><a class="header-anchor" href="#HAVING-and-GROUP-BY-and-Aggregate-Function"></a>HAVING and GROUP BY and Aggregate Function</h2>
<p><strong>HAVING is WHERE</strong> for GROUP BY and Aggregate Function.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> branchName, <span class="built_in">SUM</span>(revenue) <span class="keyword">AS</span> sum</span><br><span class="line"><span class="keyword">FROM</span> tableStores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> branchName</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(revenue) <span class="operator">&gt;</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>The result:</p>
<table>
<thead>
<tr>
<th style="text-align:center">branchName</th>
<th style="text-align:center">sum</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AAA</td>
<td style="text-align:center">1000</td>
</tr>
</tbody>
</table>
<div class="danger">
<p>In the HAVING clause, I must <strong>use original name and aggregate function to calculate again</strong>. I cannot use <code>HAVING sum &gt; 100</code>. The following statement is incorrect.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> branchName, <span class="built_in">SUM</span>(revenue) <span class="keyword">AS</span> sum</span><br><span class="line"><span class="keyword">FROM</span> tableStores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> branchName</span><br><span class="line"><span class="keyword">HAVING</span> sum <span class="operator">&gt;</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/a0hw4NJ.png" alt=""></p>
</div>
<h2 id="N’XXXXXString’"><a class="header-anchor" href="#N’XXXXXString’"></a>N’XXXXXString’</h2>
<p>N’XXXXXString’ - this N next to the string enclosed in single quotes mean that the string is NVARCHAR type if N wouldn’t be there it would be VARCHAR.</p>
<h2 id="Check-if-the-object-already-exists-or-not"><a class="header-anchor" href="#Check-if-the-object-already-exists-or-not"></a>Check if the object already exists or not</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IF <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.objects <span class="keyword">WHERE</span> object_id <span class="operator">=</span> OBJECT_ID(N<span class="string">&#x27;[tmpEmployee]&#x27;</span>) <span class="keyword">AND</span> type <span class="keyword">IN</span> (N<span class="string">&#x27;U&#x27;</span>)) </span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">   <span class="keyword">DROP</span> <span class="keyword">TABLE</span> [tmpEmployee] </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">IF OBJECT_ID (N<span class="string">&#x27;GetTop2EmpForDep&#x27;</span>, N<span class="string">&#x27;IF&#x27;</span>) <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> GetTop2EmpForDep</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<h2 id="Get-Top-10-Rows-from-a-Table-Randomly"><a class="header-anchor" href="#Get-Top-10-Rows-from-a-Table-Randomly"></a>Get Top 10 Rows from a Table Randomly</h2>
<p>The <code>NEWID()</code> function in SQL Server returns a unique ID or a random value.<br>
To return the rows in random order, adding the <code>NEWID()</code> function with the <code>ORDER BY</code> clause.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">10</span> <span class="operator">*</span> <span class="keyword">FROM</span> tablA </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> NEWID()</span><br></pre></td></tr></table></figure>
<h2 id="How-to-get-TIME-part"><a class="header-anchor" href="#How-to-get-TIME-part"></a>How to get TIME part?</h2>
<p>Use <em>data_type(length)</em> or <em>style</em> of <code>CONVERT()</code>.<br>
<span class="exturl" data-url="aHR0cHM6Ly9zcWxoaW50cy5jb20vMjAxNi8wOS8yNC9ob3ctdG8tZ2V0LWN1cnJlbnQtdGltZS1pbi1zcWwtc2VydmVyLw==">How to get current TIME in Sql Server<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">10</span>), GETDATE(), <span class="number">108</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">time</span>, GETDATE())</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Output: 12:43:38</span></span><br><span class="line"><span class="comment">-- Output: 12:43:38.6370000</span></span><br></pre></td></tr></table></figure>
<h2 id="How-to-compare-time-in-SQL-Server"><a class="header-anchor" href="#How-to-compare-time-in-SQL-Server"></a>How to compare time in SQL Server?</h2>
<ol>
<li>Convert data type (Slower):</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IF <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">8</span>), SYSDATETIME(), <span class="number">108</span>) <span class="keyword">BETWEEN</span> <span class="string">&#x27;08:00:00&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;17:30:00&#x27;</span></span><br><span class="line">    PRINT <span class="string">&#x27;Work Time.&#x27;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Compare as a floating point number (Efficient way):<br>
A date in SQL server is stored as a floating point number. The digits before the decimal point represent the date. The digits after the decimal point represent the time. Conversions between datetime and float are pretty fast, because they’re basically stored in the same way.</li>
</ol>
<p><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODA3OTA5L2hvdy1jYW4taS1jb21wYXJlLXRpbWUtaW4tc3FsLXNlcnZlcg==">How can I compare time in SQL Server?<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="EXEC-sp-executesql-sql-EXEC-sql"><a class="header-anchor" href="#EXEC-sp-executesql-sql-EXEC-sql"></a>EXEC sp_executesql @sql = EXEC (@sql)</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@sql</span>	nvarchar(max)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@sql</span> <span class="operator">=</span> <span class="string">&#x27;SELECT name </span></span><br><span class="line"><span class="string">            FROM tableStores </span></span><br><span class="line"><span class="string">            WHERE name = &#x27;&#x27;Zara&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- The followings have the same results</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_executesql <span class="variable">@sql</span></span><br><span class="line"><span class="keyword">EXEC</span> (<span class="variable">@sql</span>)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer"><!--google_adsense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6866375976707228" crossorigin="anonymous"></script>
      <div class="postfooter-google-adsense">
        <i class="fab fa-google"></i> AdSense
        <div class="google-adsense-instance">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-6866375976707228"
                data-ad-slot="8859920421"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>        
      </div>
<!--/google_adsense-->
          <div class="post-tags">
              <a href="/tags/SQL/" rel="tag"># SQL</a>
              <a href="/tags/Intermediate-Code/" rel="tag"># Intermediate Code</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/15/ReactJS/ReactJS-Tutorial-note/" rel="prev" title="ReactJS 教學系列影片筆記">
                  <i class="fa fa-angle-left"></i> ReactJS 教學系列影片筆記
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/11/08/SQL/create-demo-tables/" rel="next" title="Create Demo Tables">
                  Create Demo Tables <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Jenifer</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 強力驅動
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2plbmlmZXJzMDAxZA==" title="在 GitHub 上關注我" aria-label="在 GitHub 上關注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"disqus-comments","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
